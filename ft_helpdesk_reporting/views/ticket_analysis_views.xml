<?xml version="1.0" encoding="utf-8"?>
<odoo>

    <!-- ============================================================ -->
    <!--                        PIVOT VIEW                            -->
    <!-- ============================================================ -->
    <record id="view_ft_helpdesk_ticket_analysis_pivot" model="ir.ui.view">
        <field name="name">ft.helpdesk.ticket.analysis.pivot</field>
        <field name="model">ft.helpdesk.ticket.analysis</field>
        <field name="arch" type="xml">
            <pivot string="Ticket Analysis" sample="1">
                <field name="team_id" type="row"/>
                <field name="state" type="col"/>
                <field name="first_response_hours" type="measure"/>
                <field name="resolution_hours" type="measure"/>
            </pivot>
        </field>
    </record>

    <!-- ============================================================ -->
    <!--                        GRAPH VIEW                            -->
    <!-- ============================================================ -->
    <record id="view_ft_helpdesk_ticket_analysis_graph" model="ir.ui.view">
        <field name="name">ft.helpdesk.ticket.analysis.graph</field>
        <field name="model">ft.helpdesk.ticket.analysis</field>
        <field name="arch" type="xml">
            <graph string="Ticket Analysis" type="bar" sample="1">
                <field name="state" type="row"/>
                <field name="__count" type="measure"/>
            </graph>
        </field>
    </record>

    <!-- ============================================================ -->
    <!--                       SEARCH VIEW                            -->
    <!-- ============================================================ -->
    <record id="view_ft_helpdesk_ticket_analysis_search" model="ir.ui.view">
        <field name="name">ft.helpdesk.ticket.analysis.search</field>
        <field name="model">ft.helpdesk.ticket.analysis</field>
        <field name="arch" type="xml">
            <search string="Ticket Analysis">
                <field name="ticket_no"/>
                <field name="name"/>
                <field name="team_id"/>
                <field name="assigned_user_id"/>
                <field name="customer_id"/>
                <field name="category_id"/>
                <field name="type_id"/>

                <!-- State filters -->
                <filter name="filter_new" string="New"
                        domain="[('state', '=', 'new')]"/>
                <filter name="filter_open" string="In Progress"
                        domain="[('state', '=', 'open')]"/>
                <filter name="filter_pending_customer" string="Pending Customer"
                        domain="[('state', '=', 'pending_customer')]"/>
                <filter name="filter_pending_internal" string="Pending Internal"
                        domain="[('state', '=', 'pending_internal')]"/>
                <filter name="filter_resolved" string="Resolved"
                        domain="[('state', '=', 'resolved')]"/>
                <filter name="filter_closed" string="Closed"
                        domain="[('state', '=', 'closed')]"/>
                <filter name="filter_cancelled" string="Cancelled"
                        domain="[('state', '=', 'cancelled')]"/>
                <separator/>

                <!-- Priority filters -->
                <filter name="filter_priority_urgent" string="Urgent"
                        domain="[('priority', '=', '3')]"/>
                <filter name="filter_priority_high" string="High"
                        domain="[('priority', '=', '2')]"/>
                <separator/>

                <!-- SLA / Escalation filters -->
                <filter name="filter_sla_breached" string="SLA Breached"
                        domain="[('is_sla_breached', '=', True)]"/>
                <filter name="filter_escalated" string="Escalated"
                        domain="[('is_escalated', '=', True)]"/>
                <separator/>

                <!-- Date range filters -->
                <filter name="filter_create_today" string="Created Today"
                        domain="[('create_date', '&gt;=', (context_today()).strftime('%%Y-%%m-%%d'))]"/>
                <filter name="filter_create_this_week" string="Created This Week"
                        domain="[('create_date', '&gt;=', (context_today() - datetime.timedelta(days=context_today().weekday())).strftime('%%Y-%%m-%%d'))]"/>
                <filter name="filter_create_this_month" string="Created This Month"
                        domain="[('create_date', '&gt;=', time.strftime('%%Y-%%m-01'))]"/>
                <filter name="filter_create_this_quarter" string="Created This Quarter"
                        domain="[('create_date', '&gt;=', (context_today() - datetime.timedelta(days=(context_today().month - 1) %% 3 * 31)).strftime('%%Y-%%m-01'))]"/>
                <filter name="filter_create_this_year" string="Created This Year"
                        domain="[('create_date', '&gt;=', time.strftime('%%Y-01-01'))]"/>
                <separator/>

                <!-- Group by -->
                <filter name="groupby_team" string="Team"
                        context="{'group_by': 'team_id'}"/>
                <filter name="groupby_assignee" string="Assignee"
                        context="{'group_by': 'assigned_user_id'}"/>
                <filter name="groupby_state" string="Status"
                        context="{'group_by': 'state'}"/>
                <filter name="groupby_priority" string="Priority"
                        context="{'group_by': 'priority'}"/>
                <filter name="groupby_category" string="Category"
                        context="{'group_by': 'category_id'}"/>
                <filter name="groupby_type" string="Type"
                        context="{'group_by': 'type_id'}"/>
                <filter name="groupby_channel" string="Channel"
                        context="{'group_by': 'channel'}"/>
                <filter name="groupby_customer" string="Customer"
                        context="{'group_by': 'customer_id'}"/>
                <filter name="groupby_company" string="Company"
                        context="{'group_by': 'company_id'}"/>
                <filter name="groupby_create_date_month" string="Created Month"
                        context="{'group_by': 'create_date:month'}"/>
                <filter name="groupby_create_date_week" string="Created Week"
                        context="{'group_by': 'create_date:week'}"/>
                <filter name="groupby_close_date_month" string="Closed Month"
                        context="{'group_by': 'close_date:month'}"/>
            </search>
        </field>
    </record>

    <!-- ============================================================ -->
    <!--                      LIST (TREE) VIEW                        -->
    <!-- ============================================================ -->
    <record id="view_ft_helpdesk_ticket_analysis_list" model="ir.ui.view">
        <field name="name">ft.helpdesk.ticket.analysis.list</field>
        <field name="model">ft.helpdesk.ticket.analysis</field>
        <field name="arch" type="xml">
            <list string="Ticket Analysis" create="0" edit="0" delete="0">
                <field name="ticket_no"/>
                <field name="name"/>
                <field name="team_id"/>
                <field name="assigned_user_id"/>
                <field name="priority"/>
                <field name="state"/>
                <field name="channel"/>
                <field name="first_response_hours" widget="float_time"/>
                <field name="resolution_hours" widget="float_time"/>
                <field name="is_sla_breached"/>
                <field name="is_escalated"/>
                <field name="create_date"/>
                <field name="close_date"/>
            </list>
        </field>
    </record>

    <!-- ============================================================ -->
    <!--                       ACTION WINDOW                          -->
    <!-- ============================================================ -->
    <record id="action_ft_helpdesk_ticket_analysis" model="ir.actions.act_window">
        <field name="name">Ticket Analysis</field>
        <field name="res_model">ft.helpdesk.ticket.analysis</field>
        <field name="view_mode">pivot,graph,list</field>
        <field name="search_view_id" ref="view_ft_helpdesk_ticket_analysis_search"/>
        <field name="context">{}</field>
        <field name="help" type="html">
            <p class="o_view_nocontent_smiling_face">
                No ticket data to analyse yet.
            </p>
            <p>
                Create and process helpdesk tickets to populate the analysis report.
            </p>
        </field>
    </record>

</odoo>
